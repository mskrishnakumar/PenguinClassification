// 1. Build your request payload:
const requestBody = JSON.stringify({
  input_data: {
    columns: [
      "island",
      "bill_length_mm",
      "bill_depth_mm",
      "flipper_length_mm",
      "body_mass_g",
      "sex"
    ],
    index: [0],
    data: [
      [
        "Torgersen",  // island
        39.1,         // bill_length_mm
        18.7,         // bill_depth_mm
        181,          // flipper_length_mm
        3750,         // body_mass_g
        "male"        // sex
      ]
    ]
  }
});

// 2. Headers (replace with your key)
const requestHeaders = new Headers({
  "Content-Type": "application/json",
  "Authorization": "Bearer <FqE3UP2yZYpibSOnx2y6EEjVXqmEPi0sWYfLxYY087s81lR5wa6dJQQJ99BEAAAAAAAAAAAAINFRAZML3q9l>"
});
// target that specific deployment (optional)
requestHeaders.append("azureml-model-deployment", "penguinpredictmodel-1");

// 3. Full scoring URL (note the api-version)
const url =
  "https://penguinpredictionwg-ezwyd.westus.inference.ml.azure.com/score?api-version=2024-06-01";

// 4. Fire the request
fetch(url, {
  method: "POST",
  headers: requestHeaders,
  body: requestBody
})
  .then(async (response) => {
    if (!response.ok) {
      // grab request ID & timestamp from headers if you need them
      console.debug("Request ID:", response.headers.get("x-ms-request-id"));
      console.debug("Timestamp:", response.headers.get("x-ms-date"));
      const errorText = await response.text();
      throw new Error(`Status ${response.status}: ${errorText}`);
    }
    return response.json();
  })
  .then((json) => {
    console.log("Prediction result:", json);
    // e.g. json.predictions or json[0] depending on your scoring script
  })
  .catch((error) => {
    console.error("Invocation error:", error);
  });
